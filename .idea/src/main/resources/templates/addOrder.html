<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragment/layout :: layout(title=~{::title}, content=~{::section}, pageScripts=~{::scripts})}">
<head>
    <meta charset="UTF-8">
    <title th:text="#{add_order.title}">Add a New Order</title>
</head>
<body>
<section>
    <div class="card shadow-sm">
        <div class="card-header">
            <h1 th:text="#{add_order.header}">Create a New Order</h1>
        </div>
        <div class="card-body p-4">

            <div th:if="${#fields.hasErrors('orderViewModel.*')}" class="alert alert-danger" role="alert">
                <p class="fw-bold mb-1"><i class="bi bi-exclamation-triangle-fill me-2"></i><span th:text="#{add_order.error.header}">Please fix the following issue(s):</span></p>
                <ul>
                    <li th:each="err : ${#fields.errors('orderViewModel.*')}" th:text="${err}"></li>
                </ul>
            </div>

            <form th:action="@{/orders/add}" method="post" th:object="${orderViewModel}" autocomplete="off" id="order-form" th:attr="data-page='addOrder', data-order-success=${orderSuccess}">
                <div class="row mb-4">
                    <div class="col-lg-6 mb-3 mb-lg-0">
                        <label for="customerId" class="form-label fs-5" th:text="#{add_order.customer.label}">Select a Customer</label>
                        <select id="customerId" class="form-select form-select-lg" th:field="*{customer}" >
                            <option value="" disabled selected th:text="#{add_order.customer.placeholder}"></option>
                            <option th:each="cust : ${customers}" th:value="${cust.id}" th:text="${cust.name}"></option>
                        </select>
                    </div>
                    <div class="col-lg-6">
                        <label for="status" class="form-label fs-5" th:text="#{add_order.status.label}">Set Status</label>
                        <select id="status" class="form-select form-select-lg" th:field="*{status}" >
                            <option value="" disabled th:text="#{add_order.status.placeholder}">...</option>
                            <option th:each="s : ${allStatuses}" th:value="${s}" th:text="#{'enum.OrderStatus.' + ${s}}"></option>
                        </select>
                    </div>
                </div>

                <label class="form-label fs-5" th:text="#{add_order.menu.label}">Choose Items from the Menu</label>
                <h3 class="mt-3" th:text="#{add_order.menu.food}">Food</h3>
                <hr>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <div class="col" th:each="item : ${menuItems.?[getItemType().name() == 'FOOD']}">
                        <a th:href="@{/menu/item/{id}(id=${item.id})}"
                           class="text-decoration-none h-100 d-block"
                           th:classappend="${selectedItemIds.contains(item.id) ? 'selected-item' : ''}">
                            <div class="card menu-item-card h-100 text-center">
                                <img th:src="@{'/images/food/' + ${item.imageName}}" class="card-img-top" th:alt="${item.name}" style="height: 150px; object-fit: cover;">
                                <div class="card-body">
                                    <h6 class="card-title" th:text="#{'menu.item.' + ${item.name}}">Item Name</h6>
                                    <p class="card-text text-muted" th:text="${'€' + #numbers.formatDecimal(item.price, 1, 'COMMA', 2, 'POINT')}"></p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <h3 class="mt-4" th:text="#{add_order.menu.drinks}">Drinks</h3>
                <hr>
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <div class="col" th:each="item : ${menuItems.?[getItemType().name() == 'DRINK']}">
                        <a th:href="@{/menu/item/{id}(id=${item.id})}"
                           class="text-decoration-none h-100 d-block"
                           th:classappend="${selectedItemIds.contains(item.id) ? 'selected-item' : ''}">
                            <div class="card menu-item-card h-100 text-center">
                                <img th:src="@{'/images/drink/' + ${item.imageName}}" class="card-img-top" th:alt="${item.name}" style="height: 150px; object-fit: cover;">
                                <div class="card-body">
                                    <h6 class="card-title" th:text="#{'menu.item.' + ${item.name}}">Item Name</h6>
                                    <p class="card-text text-muted" th:text="${'€' + #numbers.formatDecimal(item.price, 1, 'COMMA', 2, 'POINT')}"></p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="d-grid gap-2 col-6 mx-auto mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle-fill me-2"></i><span th:text="#{add_order.button.place_order}">Place Order</span>
                    </button>
                </div>
            </form>

            <form th:action="@{/orders/clear-cart}" method="post" class="text-center mt-2" id="clear-cart-form">
                <button type="submit" class="btn btn-sm btn-outline-danger" th:text="#{add_order.button.clear_cart}">Clear All Items</button>
            </form>
        </div>
    </div>
</section>
<th:block th:fragment="scripts">
    <script th:src="@{/js/add-order.js}"></script>
</th:block>
</body>
</html>