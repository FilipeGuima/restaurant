<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragment/layout :: layout(title=~{::title}, content=~{::section}, pageScripts=~{::scripts})}">
<head>
    <meta charset="UTF-8">
    <title>Add a New Order</title>
</head>
<body>
<section>
    <div class="card shadow-sm">
        <div class="card-header">
            <h1>Create a New Order</h1>
        </div>
        <div class="card-body p-4">

            <div th:if="${errors}" class="alert alert-danger" role="alert">
                <p class="fw-bold mb-1"><i class="bi bi-exclamation-triangle-fill me-2"></i>Please fix the following issue(s):</p>
                <ul>
                    <li th:each="error : ${errors}" th:text="${error}"></li>
                </ul>
            </div>

            <form id="details-form" th:action="@{/orders/update-details}" method="post">
                <div class="row mb-4">
                    <div class="col-lg-6 mb-3 mb-lg-0">
                        <label for="customerId" class="form-label fs-5">Select a Customer</label>
                        <select id="customerId" name="customerId" class="form-select form-select-lg" required>
                            <option value="" disabled selected>...Choose a customer...</option>
                            <option th:each="customer : ${customers}"
                                    th:value="${customer.id}"
                                    th:text="${customer.name}"
                                    th:selected="${customer.id == selectedCustomerId}"></option>
                        </select>
                    </div>
                    <div class="col-lg-6">
                        <label for="status" class="form-label fs-5">Set Status</label>
                        <select id="status" name="status" class="form-select form-select-lg" required>
                            <option value="" disabled selected>...Choose a Status...</option>
                            <option th:each="s : ${status}"
                                    th:value="${s}"
                                    th:text="${s}"
                                    th:selected="${s == selectedStatus}"></option>
                        </select>
                    </div>
                </div>
            </form>

            <label class="form-label fs-5">Choose Items from the Menu</label>
            <h3 class="mt-3">Food</h3>
            <hr>
            <div class="row row-cols-1 row-cols-md-3 g-4">
                <div class="col" th:each="item : ${menuItems.?[getItemType().name() == 'FOOD']}">
                    <a th:href="@{/menu/item/{id}(id=${item.id})}"
                       class="text-decoration-none h-100 d-block"
                       th:classappend="${selectedItemIds.contains(item.id) ? 'selected-item' : ''}">
                        <div class="card menu-item-card h-100 text-center">
                            <img th:src="@{'/images/food/' + ${item.imageName}}" class="card-img-top" th:alt="${item.name}" style="height: 150px; object-fit: cover;">
                            <div class="card-body">
                                <h6 class="card-title" th:text="${item.name}">Item Name</h6>
                                <p class="card-text text-muted" th:text="${'€' + #numbers.formatDecimal(item.price, 1, 'COMMA', 2, 'POINT')}"></p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <h3 class="mt-4">Drinks</h3>
            <hr>
            <div class="row row-cols-1 row-cols-md-3 g-4">
                <div class="col" th:each="item : ${menuItems.?[getItemType().name() == 'DRINK']}">
                    <a th:href="@{/menu/item/{id}(id=${item.id})}"
                       class="text-decoration-none h-100 d-block"
                       th:classappend="${selectedItemIds.contains(item.id) ? 'selected-item' : ''}">
                        <div class="card menu-item-card h-100 text-center">
                            <img th:src="@{'/images/drink/' + ${item.imageName}}" class="card-img-top" th:alt="${item.name}" style="height: 150px; object-fit: cover;">
                            <div class="card-body">
                                <h6 class="card-title" th:text="${item.name}">Item Name</h6>
                                <p class="card-text text-muted" th:text="${'€' + #numbers.formatDecimal(item.price, 1, 'COMMA', 2, 'POINT')}"></p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>

            <form th:action="@{/orders/add}" method="post">
                <div class="d-grid gap-2 col-6 mx-auto mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle-fill me-2"></i>Place Order
                    </button>
                </div>
            </form>

            <form th:action="@{/orders/clear-cart}" method="post" class="text-center mt-2">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                    Clear All Items
                </button>
            </form>

        </div>
    </div>
</section>

<th:block th:fragment="scripts">
    <script th:src="@{/js/add-order.js}"></script>
</th:block>

</body>
</html>